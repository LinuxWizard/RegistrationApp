<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="master.css">
		<meta charset="UTF-8">
		<title>MAES Registration</title>			
		<script src="jquery.min.js"></script>
		<script type="text/javascript" src="accessdb.js"></script>
	</head>

	<body>
		<img src="maes-logo.jpg" alt="Pledge Your Loyalty" style="width:304px;height:304px;">
		<div class=container>

			<p class=blocktext>Enter your information Please.</p>
				First name:<br>
				<input type="text" id="fname">
				<br>
				Last name:<br>
				<input type="text" id="lname">
				<br>
				<input type="radio" id="r1" name="membershipLevel" value="student" checked>Student
				<input type="radio" id="r2" name="membershipLevel" value="professional">Professional
				<br>
				Please select your school/affiliation:<br>
				<select name="schools" id="s1">
					<option value="Arizona State University">Arizona State University</option>
					<option value="At Large">At Large</option>
					<option value="Colorado State University - Pueblo">Colorado State University - Pueblo</option>
					<option value="CSU, Chico">CSU, Chico</option>
					<option value="CSU, Fullerton">CSU, Fullerton</option>
					<option value="CSU, Long Beach">CSU, Long Beach</option>
					<option value="George Mason Universtiy">George Mason University</option>
					<option value="Iowa State University">Iowa State University</option>
					<option value="Laredo Community College">Laredo Community College</option>
					<option value="Long Beach City College">Long Beach City College</option>
					<option value="Massachusetts Institute of Technology">Massachusetts Institute of Technology</option>
					<option value="New Mexico State University">New Mexico State University</option>
					<option value="Purdue University">Purdue University</option>
					<option value="San Antonio College">San Antonio College</option>
					<option value="San Diego State University">San Diego State University</option>
					<option value="San Jose State University">San Jose State University</option>
					<option value="Texas A&M">Texas A&M </option>
					<option value="Texas A&M, Kingsville">Texas A&M, Kingsville</option>
					<option value="Texas State University, San Marcos">Texas State University, San Marcos</option>
					<option value="Tufts University">Tufts University</option>
					<option value="UC, Davis">University of California, Davis</option>
					<option value="UC, Irvine">University of California, Irvine</option>
					<option value="University of California, Berkeley">University of California, Berkeley</option>
					<option value="University of Colorado Boulder">University of Colorado Boulder</option>
					<option value="University of Houston">University of Houston</option>
					<option value="University of Nebraska at Omaha">University of Nebraska at Omaha</option>
					<option value="University of Nevada, Las Vegas">University of Nevada, Las Vegas</option>
					<option value="University of New Mexico">University of New Mexico</option>
					<option value="UT, El Paso">University of Texas, El Paso</option>
					<option value="UT, Pan Am">University of Texas, Pan Am</option>
					<option value="UT, San Antonio">University of Texas, San Antonio</option>
				</select>
					
				<select name="professionalChapters"  class="select3-basic" id="s2">
					<option value="At Large">At Large</option>
					<option value="Bay Area">Bay Area Professional Chapter</option>
					<option value="El Paso">El Paso Professional Chapter</option>
					<option value="Houston">Houston Professional Chapter</option>
					<option value="Long Beach">Long Beach Professional Chapter</option>
					<option value="Metro DC">Metro DC Professional Chapter</option>
					<option value="Orange County">Orange County Professional Chapter</option>
					<option value="San Diego">San Diego Professional Chapter</option>
					<option value="Texas A&M">Texas A&M Professional Chapter</option>
				</select>
				<br><br>
			<b>By submitting, I agree that I have read and understood 
			<br>the MAES <a href="TandC.html"  onclick="window.open('TandC.html', 'myWindow', 'status = 1, height = 600, width = 600, resizable = 0' ); return false;">code</a> of conduct.</b><br />
				I accept: <input type="checkbox" value="0" name="agree"><br>
			<button onclick="return checkCheckBox(this)">Check In</button>

			<p class=blocktext>If you are registered your badge will be printed</p>

		</div>
		<div id="idContainer" height=0 width=0></div>
		
		<script>
		//functions to load pdf of name badge into invisible frame and print
		function PrintPdf() {
			idPdf.Print();
		}

		function idPdf_onreadystatechange() {
			if (idPdf.readyState === 4)
				setTimeout(PrintPdf, 1000);
		}

		function LoadAndPrint(url)
		{
			idContainer.innerHTML = 
				'<object id="idPdf" onreadystatechange="idPdf_onreadystatechange()"'+
					'width="0" height="0" type="application/pdf"' +
					'data="' + url + '?#view=Fit&scrollbar=0&toolbar=0&navpanes=0">' +
					'<span>PDF plugin is not available.</span>'+
				'</object>';
		}
		
		function searchRegistration() {
		//Function to look through DB and print name badges
			//Get value of radio button and set variable
			if (document.getElementById('r1').checked) {
				var membership = document.getElementById('r1').value;
				var selectedGroup = document.getElementById('s1').value;
			}
			else{
				var membership = document.getElementById('r2').value;
				var selectedGroup = document.getElementById('s2').value;
			}
			//Initiate other variables from what was submitted
			var firstName = document.getElementById("fname").value;
			fname.value="";
			var lastName = document.getElementById("lname").value;
			lname.value="";
			
			//Initiate sql queries to be used
			if(membership === "student"){
				var checkNameSQL = "SELECT First_Name FROM 2014_Student_Registration WHERE Primary_Group='Student Chapters: "+selectedGroup+"' AND First_Name='"+firstName+"' AND Last_Name='"+lastName+"'";
				var updatePrintSQL = "UPDATE 2014_Student_Registration SET BadgePrinted="+true+" WHERE Primary_Group='Student Chapters: "+selectedGroup+"' AND First_Name='"+firstName+"' AND Last_Name='"+lastName+"' AND Paid="+true;
			}
			else{
				var checkNameSQL = "SELECT First_Name FROM 2014_Professional_Registration WHERE Primary_Group='Professional Chapters: "+selectedGroup+"' AND First_Name='"+firstName+"' AND Last_Name='"+lastName+"'";
				var updatePrintSQL = "UPDATE 2014_Professional_Registration SET BadgePrinted="+true+" WHERE Primary_Group='Professional Chapters: "+selectedGroup+"' AND First_Name='"+firstName+"' AND Last_Name='"+lastName+"' AND Paid="+true;
			}
			
			//Obtain current system path
			var currentPath = ((location+"").replace(/%20/g, " ").replace("file:///", "").replace("\\", "/").replace("index.html", ""));
			
			//Initiate database object
			var myDB = new ACCESSdb(currentPath+"Membership.mdb",  {showErrors:true})
			
			//If the name is found check for paid status
			if(myDB.query(checkNameSQL)) {
				checkNameSQL = checkNameSQL+" AND Paid="+true;
				
				//if name and paid status are correct check for badge printed status
				if(myDB.query(checkNameSQL)){
					checkNameSQL = checkNameSQL+" AND BadgePrinted="+false;
					
					//If badge not printed, print and update BadgePrinted state to true
					if(myDB.query(checkNameSQL)){
						alert("Badge is being printed!");
						myDB.query(updatePrintSQL);
						LoadAndPrint(currentPath+"badges/"+membership+"/"+selectedGroup+"/"+firstName+lastName+".pdf");
					}
					//If BadgePrinted is true throw alert message
					else{
						alert("Badge Already Printed! If this is a mistake contact staff member");
					}
				}
				//If Paid is false throw error message
				else{
					alert("Registration not paid yet. If this is an error contact staff member.");
				}
			}
			//if name is not found throw warning message
			else{
			alert("Name not found in registration list. Contact Staff Member.")
			}
		}
		
		function checkCheckBox(f){
			if (agree.checked == false )
			{
				alert('Please check the box to continue.');
				return false;
			}else
				searchRegistration();
		}
		
		
		//Function to switch drop-down lists on radio button check
		$('[name="membershipLevel"]').on('change', function() {
			var state = this.id == 'r2';
			$('[name="professionalChapters"]').toggle(state);
			$('[name="schools"]').toggle(!state);
		});
		
		</script>
		


	</body>

</html>